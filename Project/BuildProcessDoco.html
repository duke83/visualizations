<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">

    <link rel="stylesheet" href="../public/App/css/CTV2_Common.css">
    <link rel="stylesheet" href="../public/App/css/CreateReport.css">
    <link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.css">

    <link href='http://fonts.googleapis.com/css?family=Pontano+Sans' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.1/themes/smoothness/jquery-ui.css">

    <script src="../node_modules/jquery/dist/jquery.js"></script>
    <script src="../node_modules/underscore/underscore.js"></script>
    <script src="../bower_components/angular/angular.js"></script>

    <script src="../bower_components/angular-dragdrop/src/angular-dragdrop.min.js"></script>
    <script src="../public/App/appCreateReport.js"></script>
    <script src="../public/App/ReportDataService.js"></script>


    <script src="../public/App/ng-google-chart-kdm.js"></script>
    <script src="../public/superViz/superViz.js"></script>
    <script src="../public/App/MetricMakerSrvc.js"></script>
    <script src="../public/superViz/svOptionsPanel/svOptionsPanel.js"></script>
    <script src="../public/superViz/testChartContainer/testChartContainer.js"></script>

    <script src="../external_components/textAngular.js"></script>
    <script src="../external_components/textAngular-sanitize.js"></script>
    <script src="../external_components/textAngularSetup.js"></script>
    <script src="../bower_components/angular-resource/angular-resource.js"></script>
    <script src="../bower_components/angular-animate/angular-animate.min.js"></script>
    <script src="../bower_components/angular-bootstrap/ui-bootstrap.js"></script>
    <script src="../bower_components/angular-bootstrap/ui-bootstrap-tpls.js"></script>

    <script src="../external_components/kdmDevTools/kdmDevToolsApp.js"></script>

    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.2/styles/default.min.css">
    <script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.2/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <script type="text/javascript">
        appCreateReport.controller('superVisTestCtrl', function ($scope, MetricMakerSrvc) {
            $scope.MetricMakerSrvc = MetricMakerSrvc;
        })


    </script>

    <title></title>
    <style>
        h4 {
            font-size: large;
            margin-top: 60px;
            font-weight: bold;
        }

        body {
            padding: 50px
        }

        li {
            margin-top: 10px;
        }
    </style>
</head>
<body ng-app="AppCreateReport" ng-controller="superVisTestCtrl">
<h2>Build Process</h2>
A project optimized for development is very different than a project optimized
for production.

<h4>Directory Structure</h4>

<ul>
    <li>Dev Directory Structure -- The directory structure makes a big difference in the ease and efficiency of
        development.
        <ul>
            <li>Organized by feature.</li>

            <li>Quickly and liberally add new files.</li>
            <li>Isolated development -- SOLID</li>

        </ul>
    </li>
    <li>
        <p>Prod Directory Structure</p>
    </li>
</ul>
<img src="https://www.lucidchart.com/publicSegments/view/5436c5f7-1154-4b31-a880-2f020a00caaf/image.png" width="500"
     alt=""/>


<!--------------------------------- GRUNT BUILD ------------------------------------->
<h4>Grunt</h4>

<p>See <a href="http://g00glen00b.be/angular-grunt/" target="info">http://g00glen00b.be/angular-grunt/</a> for a good
    write-up on this.</p>
<ul>
    <li>Compile Angular Partials -- Use <a src="https://github.com/karlgoldstein/grunt-html2js.html" target="_blank">html2js</a>
        plugin to wrap all html partials in javascript and inject into angular module that is makes them availabe in
        $templateCache. (Don't include *doco.html files
    <pre><code>html2js: {
        options: {
        base:'../dist/'
        },
        dist: {
        src: ['public/**/*.html', '!public/**/*doco.html', '!public/**/*Doco.html', '!test.*.html'],
        dest: 'dist/templates.js'
        }
        },</code></pre>
        then run "grunt html2js" in terminal.
    </li>


    <!-----------------PATHS TO ICONS-------------->
    <li>In templates.js, replace
        <p>$templateCache.put("../visualizations/public</p>
        with <p>$templateCache.put("public</p> <p>(The templateCache key must match the templateUrl in the directive)</p>


    </li>
    <li>In templates.js, replace <p>ng-src=\"external_components</p> with  <p>ng-src=\"../external_components</p>
        <p>(These are icon files where path is not already corrected by other procedures.)</p>

    </li>
    <li>Concatenate all javascript files (modules, directives, services) into a single javascript file.
    <pre><code>concat:{
        options:{
        separator:';'
        },
        dist:{
        src:['public/app/appCreateReport.js','public/**/*.js'],
        dest:'dist/createReport.js'
        }
        },</code></pre>
        then run "grunt concat" in terminal.
    </li>
    <li>In dist/createReport.js, delete module reference to kdm-dev-tools</li>
    <li>In dist/createReport.js, add module reference to templates-dist</li>
    <li>Copy index.html to test.index.html</li>
    <li>Move test.index.html to dist directory (make sure script and link references are updated)</li>
    <li>Delete the following sections in the head
        <ul>
            <li>CREATEREPORT APPLICATION AND SERVICES</li>
            <li>SUPERVIZ DIRECTIVES</li>
            <li>LAYOUT DIRECTIVES</li>
            <li>OTHER DIRECTIVES</li>
            <li>KDM DEV TOOLS</li>
            <li>LOCAL TEST CONTROLLER</li>
            <li>Other local script and css</li>
        </ul>
    </li>
    <li>Insert references to the newly generated app.js and templates.js files
        <ul>
            <li>    &lt;script src="createReport.js">&lt/script></li>
                <li>&ltscript src="templates.js">&lt/script></li>
        </ul>
    </li>
<li>Run it in dist.  Look in firebug for network missed files.  Look at UI to be sure icons show up and everything is working.</li>
</ul>
Synchronize script and link tags. (see <a href="https://www.npmjs.org/package/grunt-script-link-tags"
                                              target="info">https://www.npmjs.org/package/grunt-script-link-tags</a>


<!------------------------------ ASP.NET INTEGRATION----------------------------------->

<h4>ASP.NET INTEGRATION</h4>
<ul>
    <li>Report.cshtml --
        <ul>
            <li>copy the guts of dist.index.html into report.cshtml. Basically, everything inside the body tag (exclusive) needs
                to be replaced. This will be the &lt;div id="createReport" ng-app="AppCreateReport"
                ng-controller="CreateReportCtrl"> tag and all it's contents.
            </li>
            <li>Make sure createReport.js link exists in the MVC include page section <code>@section JavaScript {... </code>

            </li>
            <li>Replace contents of asp.net:createReport.js with contents of webstorm:dist/createReport.js</li>
            <li>Replace contents of asp.net:templates.js with contents of webstorm:dist/templates.js</li>
            <li>Replace contents of asp.net:CTV2_CreateReport.less with contents from webstorm:public/app/css/CreateReport.less.</li>
            <li>In asp.net:templates.js, replace
            <p>src=\"../external_components/icons/svg/"</p>
                <p>with</p>
            <p>src=\"./scripts/CTV2App/Report/external_components/icons/</p></li>
            <li>Run locally from Visual Studio.  Look in firebug for errors, missing files. Look at UI for missing icons and general functionality.</li>
            <li>Get latest version from TFS, merge any conflicts, run locally again.</li>
            <li>Publish to Staging server (\\dv-istaging-01\c$\inetpub\wwwroot\ctv2prototype)
            <p><a href="http://dv-istaging-01/ctv2prototype/">http://dv-istaging-01/ctv2prototype/</a></p>
            </li>
        </ul>
    </li>
    <li></li>
    <li></li>
    <li></li>
</ul>

<h4>External Libraries</h4>
<ul>
    <li>NPM
        <ul>
            <li>npm install -- installs all devdependencies (libraries) listed in package.json</li>
            <li>npm install jquery-ui --save-dev</li>
            <li>package.json -- At time of this writing devDependencies include:<br/> {

                "bootstrap": "^3.2.0",
                "grunt": "^0.4.5",
                "grunt-bower-task": "~0.3.4",
                "grunt-contrib-clean": "~0.5.0",
                "grunt-contrib-compress": "~0.9.1",
                "grunt-contrib-concat": "~0.4.0",
                "grunt-contrib-connect": "~0.8.0",
                "grunt-contrib-jshint": "~0.10.0",
                "grunt-contrib-uglify": "^0.6.0",
                "grunt-contrib-watch": "~0.6.1",
                "grunt-karma": "~0.8.0",
                "jquery": "^2.1.1",
                "karma": "~0.12.0",
                "karma-jasmine": "~0.1.0",
                "karma-ng-html2js-preprocessor": "~0.1.0",
                "karma-phantomjs-launcher": "~0.1.4",
                "underscore": "^1.7.0"
                }
            </li>
        </ul>
    </li>
    <li>Bower
        <ul>
            <li>Angular libraries -- The angular team preffers to NOT publish via NPM. They solely use Bower.</li>
            <li>bower install angular-bootstrap<br/> bower install angular-resource<br/>
                bower install angular-animate<br/>bower install angular#1.2.26
            </li>
        </ul>
    </li>
</ul>
<h4>Source Control</h4>
The external libraries need not be tracked in source control for this project. Since they can be easily installed
from their own repositories, vc systems that are tracking this project can be configured to simply ignore them.
<kdm-navigation></kdm-navigation>
</body>
</html>
