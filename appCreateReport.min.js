var appCreateReport=angular.module("AppCreateReport",["ngDragDrop","textAngular","googlechart","ui.bootstrap","ngResource","ngAnimate","kdmDevTools"]);appCreateReport.config(["$httpProvider",function(a){$.support.cors=!0,a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"]}]),appCreateReport.controller("CreateReportCtrl",function(a,b,c){a.spots=b.allSpots,a.reportdataservice=c,a.allQuestions=c.getAllQuestions,a.$watch(function(){return c.surveyTemplateId},function(){console.log(arguments),a.allQuestions=c.getAllQuestions(c.surveyTemplateId)}),a.chartsvc=chartservice,a.questionfiltertest=function(b){return b.qtext.toLowerCase().indexOf(a.questionFilter.toLowerCase())>-1?!0:void 0}}),appCreateReport.directive("questionSelector",function(a){return{restrict:"E",replace:!0,scope:{question:"="},templateUrl:"questionSelector.html",link:function(b){console.log("questionSelector.question",b.question,b),b.jqoptions={revert:"invalid"},b.startdragging=function(){alert("dragging"),console.log("scp.startdragging",arguments,b.question),angular.copy(b.question,a.questionInDrag)},b.testme=function(){alert("hello")}}}}),appCreateReport.directive("spotContainer",function(a,b,c){return{restrict:"E",scope:{y:"=y"},templateUrl:"SpotContainer.html",link:function(d,e,f){console.log("rows",parseInt(f.rows),"columns",parseInt(f.columns)),d.rows=0,d.columns=parseInt(f.columns),d.$watch(function(){return c.layoutmode},function(a){d.layoutmode=a}),c.registercolumncount(d.columns),d.addRow=function(){d.rows++;for(var g=$("<span/>").addClass("row"),h=1;h<=parseInt(f.columns);h++){var i=(b.$new(!0),a("<spot rownumber='"+d.rows+"' columnnumber='"+h+"'></spot>")(d));c.registerspot(d.rows,h),g.append(i)}e.find(".ChildrenArea").append(g)};for(var g=1;g<=parseInt(f.rows);g++)d.addRow();d.togglelayoutmode=function(){c.layoutmode=!c.layoutmode}}}}),appCreateReport.directive("spot",function(a,b,c,d){return{restrict:"E",replace:!0,scope:{rownumber:"@",columnnumber:"@"},templateUrl:"spot.html",link:function(e,f){e.$watch(function(){return a.getspot(e.rownumber,e.columnnumber)},function(a){e.rowspan=a.rowspan,e.colspan=a.colspan,e.overwritten=a.overwritten,e.isHighlighted=a.isHighlighted,e.jquuidroppable=e.overwritten?{}:{onDrop:"dropquestionselectorhere()"}},!0),e.jquuidroppable={onDrop:"dropquestionselectorhere()"},e.jqyouioptions={accept:".questionselector, .chartcontainer",revert:!0},e.mousedownstartselecting=function(){a.layoutmode&&(a.selectingmode=!0,a.startselecting(e.rownumber,e.columnnumber))},e.mouseupstopselecting=function(){a.layoutmode&&(a.stopselecting(e.rownumber,e.columnnumber),a.selectingmode=!1)},e.mouseenterwhileselecting=function(){1==a.layoutmode&&1==a.selectingmode&&a.buildselection(e.rownumber,e.columnnumber)},e.clickonspot=function(){$(".chartcontainer").removeClass("highlighted"),d.chartInEdit={},a.layoutmode&&a.deleteexpansionset(e.rownumber,e.columnnumber)},e.dropquestionselectorhere=function(d,g){console.log("spot dropquestionselectorhere",d,g,e.rownumber,e.columnnumber,e,a.questionInDrag,a.sourceChartContainer());var h="questionselector";if(arguments[1].draggable.hasClass("chartcontainer")&&(h="chartcontainer"),a.spotIsTheOriginatoryInAnExpansionset(e.rownumber,e.columnnumber)){if("questionselector"==h){var i=c.$new(!0);i.questionsel=angular.copy(a.questionInDrag),i.spot=angular.copy(a.getspot(e.rownumber,e.columnnumber)),i.rowspan=e.rowspan,i.colspan=e.colspan,"Text Panel"==i.questionsel.qtext?el.append(b("<textlabel questionsel='questionsel'></textlabel>")(i)):a.instanciateChartContainer(a.questionInDrag.defaultChartType,f,i)}if("chartcontainer"==h){var j=f.find(".chartcontainer");0==j.length?a.moveChartToLocation(a.sourceChartContainer(),f.find(".panelarea1")):a.swapChartContainers(a.sourceChartContainer(),j),$(j).css("z-index","1")}}return!1}}}}),appCreateReport.directive("textlabel",function(){return{restrict:"E",replace:!0,scope:{spot:"=",questionsel:"="},templateUrl:"textlabel.html",link:function(a,b){console.log("textlabel scope",a),a.deleteme=function(){b.remove()}}}}),appCreateReport.directive("chartcontainer",function(a,b){return{restrict:"E",replace:!0,scope:{spot:"=hostspot",questionsel:"="},templateUrl:"chartcontainer.html",link:function(c,d){d.attr("Id",guid());var e=(c.questionsel.defaultChartType,c.questionsel.data,$(d).find(".payload"));b.buildChart(e,c.questionsel),console.log("chartcontainer scope",c,c.questionsel.qtext,"spot",c.spot),c.startdragging=function(){d.addClass("currentlydragging"),console.log("chartcontainer scp.startdragging",arguments,c,d),angular.copy(c.questionsel,a.questionInDrag)},c.stopdragging=function(){console.log("scp.stopdragging called in chartcontainer","arguments",arguments,"scope",c),d.removeClass("currentlydragging")},c.deleteme=function(){d.remove(),angular.copy({},b.chartInEdit)},c.editchart=function(){$(".chartcontainer").removeClass("highlighted"),d.addClass("highlighted"),b.chartInEdit=$(d).find(".payload").find(".ng-scope").scope().chart,console.log("chartservice.chartInEdit",b.chartInEdit)}}}}),appCreateReport.directive("paneloptions",function(a,b){return{restrict:"E",replace:!0,templateUrl:"paneloptions.html",link:function(c,d){c.ClickChartType=function(e){console.log("clicked ",e,c);var f=b.$new(!0);f.questionsel=angular.copy(c.questionsel),a.instanciateChartContainer(e,d,f)}}}});var guid=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return"q"+a()+a()+a()},getrandom=function(){var a=10,b=100,c=Math.floor(Math.random()*(b-a+1))+a;return c},ExpansionSet=function(a,b,c,d){return _originatorRow=a,_originatorCol=b,_terminalRow=c,_terminalCol=d,{originatorRow:_originatorRow,originatorCol:_originatorCol,terminalRow:_terminalRow,terminalCol:_terminalCol}},Spot=function(a,b){return _col=b,_row=a,_rowspan=1,_colspan=1,{col:_col,row:_row,rowspan:_rowspan,colspan:_colspan}};